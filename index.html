<!DOCTYPE html>
<html>
<head>
    <title>Stock Data Visualization with Alpha Vantage</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
    <div id="visualization"></div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            fetchDataAndUpdate();
        });

        function fetchDataAndUpdate() {
            const apiKey = 'EUQFBOQFK4R58QWU';
            const symbol = 'IBM'; // Example stock symbol
            const url = `https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=${symbol}&interval=5min&apikey=${apiKey}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const timeSeries = data['Time Series (5min)'];
                    const processedData = Object.entries(timeSeries).map(([date, data]) => ({
                        date: new Date(date),
                        value: +data['4. close']
                    }));

                    // Clear previous visualization
                    document.getElementById('visualization').innerHTML = '';

                    // Set dimensions for the chart
                    const margin = {top: 20, right: 20, bottom: 30, left: 50},
                        width = 960 - margin.left - margin.right,
                        height = 500 - margin.top - margin.bottom;

                    // Create a new SVG element
                    const svg = d3.select('#visualization').append('svg')
                                  .attr('width', width + margin.left + margin.right)
                                  .attr('height', height + margin.top + margin.bottom)
                                .append('g')
                                  .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

                    // Set the ranges
                    const x = d3.scaleTime().range([0, width]);
                    const y = d3.scaleLinear().range([height, 0]);

                    // Define the line
                    const valueline = d3.line()
                        .x(d => x(d.date))
                        .y(d => y(d.value));

                    // Scale the range of the data
                    x.domain(d3.extent(processedData, d => d.date));
                    y.domain([0, d3.max(processedData, d => d.value)]);

                    // Add the valueline path
                    svg.append('path')
                        .data([processedData])
                        .attr('class', 'line')
                        .attr('d', valueline);

                    // Add the X Axis
                    svg.append('g')
                        .attr('transform', 'translate(0,' + height + ')')
                        .call(d3.axisBottom(x));

                    // Add the Y Axis
                    svg.append('g')
                        .call(d3.axisLeft(y));
                })
                .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>
